# 软件设计书
> - pan 4.22 14:00
> 该部分主要是对软件设计的一些说明，包括软件的整体架构、模块划分、模块功能、模块接口、模块实现、模块测试等。

## 1. 软件整体架构

### 1. 独立运行的 WebDICOM 服务
为了演示的方便，这一块会在服务器上进行开发。具体也不难，只要能 CURD dicom数据就可以了。这一块应该尽快开发，大概一周左右就可以了。 可以直接想办法运行现成的 [NeurDICOM](https://github.com/reactmed/neurdicom) 服务，然后在上面进行修改。当然，如果实在跑不起来，也可以直接自己写一个后端。因为都是重复性的增删查改，写起来很快的。

### 2. 基于 Vue 的前端

> 组件式开发，后期会划分组件开发的任务。这一块难度较大。而且要调用模型接口，所以开发的时候，假如模型还没有整理好，就需要先用假数据支撑开发。
根据功能划分成如下功能模块，每一个模块都必须测试通过，尽可能实现易于理解、易于扩展、易于维护的代码。

#### 3D 视图查看器 : (3DViewer)
- 将使用 VTK.js 进行渲染。
- 这一部分的代码需要支持多种渲染方式，比如：体素渲染、线框渲染、透明渲染等。
- 对于可重用性以及可扩展性要求较高，因为后期可能会有其他的渲染需求会调用该模块。

#### Segmentation Label 标注 : (SegmentationEditor)
这一块就是对某一图层的不同组织进行标注。`例如`:

    骨骼组织标注为 1，
    肌肉组织标注为 2，
    脂肪组织标注为 3，等等

* 这一块标注数据的存储方式，肯定是在原来的数据之外新建一个利于处理的数据结构，然后在这个数据结构上进行操作。可以考虑使用 [Undo/Redo](https://en.wikipedia.org/wiki/Undo) 的方式，也可以考虑使用 [Diff](https://en.wikipedia.org/wiki/Diff) 的方式。肯定是在原来的数据之外新建一个利于处理的数据结构，然后在这个数据结构上进行操作。
* 比赛要求标注能渲染成三维的，这里不难，就是重用一下 3D 分割结果渲染 的代码。

#### 2D 视图查看器 : (2DViewer)
这一块将采用 [cornerstone](https://www.cornerstonejs.org/) 进行开发，与 Segmentation Label 标注 结合紧密，可能在实现的时候就是将 Segmentation Label 部分的功能逻辑作为 2DViewer 的一个插件。
- 需要实现量测、标注等功能。这些功能的大部分都是基于 [cornerstone](https://www.cornerstonejs.org/) 的插件实现的，所以这一块的开发难度不大。

### 3. 后端算法模块

#### 1. 实体数据管理模块 : (EntityDataManager)
* 实体指的是 DICOM 数据，以及 DICOM 数据的分割结果。该模块是在宏观层面对数据进行管理，维护数据的一致性，唯一性。就是说，已经有的数据不能重复传入。
* 这一块有些功能与 WebDICOM 服务 有重叠，可能需要合并。
#### 2. 功能算法模块 : (FunctionAlgorithmManager)
* 这一块是对前端算法的补充，需要前后端协调后共同开发。

### 4. AI模型模块 : (AIModelManager)
* 如果能在百度上部署就不用本地部署了，这样就不用考虑模型的部署问题了。